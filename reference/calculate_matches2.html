<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Calculates matches for one or more children by blended distance matching — calculate_matches2 • curvematching</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Calculates matches for one or more children by blended distance matching — calculate_matches2"><meta property="og:description" content="Curve matching is a technology that aims to predict individual growth curves.
The method finds persons similar to the target person, and learn the possible
future course of growth from the realized curves of the matched individuals."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">curvematching</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.14.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/growthcharts/curvematching/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculates matches for one or more children by blended distance matching</h1>
    <small class="dont-index">Source: <a href="https://github.com/growthcharts/curvematching/blob/HEAD/R/calculate_matches2.R" class="external-link"><code>R/calculate_matches2.R</code></a></small>
    <div class="hidden name"><code>calculate_matches2.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Curve matching is a technology that aims to predict individual growth curves.
The method finds persons similar to the target person, and learn the possible
future course of growth from the realized curves of the matched individuals.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">calculate_matches2</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  <span class="va">newdata</span>,</span>
<span>  y_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">0L</span><span class="op">)</span>,</span>
<span>  x_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">0L</span><span class="op">)</span>,</span>
<span>  e_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">0L</span><span class="op">)</span>,</span>
<span>  t_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">0L</span><span class="op">)</span>,</span>
<span>  subset <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">10L</span>,</span>
<span>  replace <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  blend <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  break_ties <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  kappa <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>data</dt>
<dd><p>A <code>data.frame</code> or <code>tbl_df</code> with donor data. One row is
one potential donor.</p></dd>


<dt>newdata</dt>
<dd><p>A <code>data.frame</code> or <code>tbl_df</code> with data of children for
which we seek matches. Every row corresponds to one child.</p></dd>


<dt>y_name</dt>
<dd><p>A character vector containing the names of the dependent
variables in <code>data</code>.</p></dd>


<dt>x_name</dt>
<dd><p>A character vector containing the names of predictive variables
in <code>data</code> to will go into the linear part of the model.</p></dd>


<dt>e_name</dt>
<dd><p>A character vector containing the names of the variables for
which the match should be exact.</p></dd>


<dt>t_name</dt>
<dd><p>A character vector containing the names of the treatment
variables in <code>data</code>. The current function will only fit the model to
only the first element of <code>t_name</code>.</p></dd>


<dt>subset</dt>
<dd><p>Logical expression defining the set of rows taken from
<code>data</code>. This subset is selected before any other calculations are
made, and this can be used to trim down the size of the data in which
matches are defined and sought.</p></dd>


<dt>k</dt>
<dd><p>Requested number of matches. The default is <code>k = 10</code>.</p></dd>


<dt>replace</dt>
<dd><p>A logical that indicates whether to match with or without
replacement. The default is <code>FALSE</code>.</p></dd>


<dt>blend</dt>
<dd><p>An integer value between 0 and 1 that indicates the blend
between predictive mean matching with replacement (<code>1</code>) and euclidian
distance matching (<code>0</code>). The default is <code>1</code>.</p></dd>


<dt>break_ties</dt>
<dd><p>A logical indicating whether ties should broken randomly.
The default (<code>TRUE</code>) breaks ties randomly.</p></dd>


<dt>kappa</dt>
<dd><p>A numeric value that serves as the sensitivity parameter for the
inverse distance weighting. Used when drawing with replacement. The default
is <code>3</code>.</p></dd>


<dt>verbose</dt>
<dd><p>A logical indicating whether diagnostic information should be
printed.</p></dd>


<dt>...</dt>
<dd><p>Arguments passed down to <code>match_pmm()</code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>An object of class <code>match_list</code> which can be post-processed by
the <code>extract_matches</code> function to extract the row numbers in
<code>data</code> of the matched children. The length of the list will be always
equal to <code>m</code> if <code>replace == TRUE</code>, but may be shorter if
<code>replace == FALSE</code> if the donors are exhausted. The length is zero if
no matches can be found.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The function finds <code>k</code> matches for an individual in the same data set by
means of stratified predictive mean matching or by nearest neighbour matching.</p>
<p>The procedure search for matches in <code>data</code> for each row
in <code>newdata</code>.
Note that if <code>x_name</code> contains one or more factors, then it is
possible that the factor level of the target case is unique among all
potential donors. In that case, the model can still be fit, but prediction
will fail, and hence no matches will be found.</p>
<p>If <code>break_ties</code> is <code>FALSE</code>, the function returns the first <code>nmatch</code>
matches as they appear in the order of <code>data</code>. This method overuses
the first part of the data if there are ties, and hence may underestimate
variability. The default option is to break ties randomly.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>van Buuren, S. (2014). <em>Curve matching: A data-driven
technique to improve individual prediction of childhood growth</em>. Annals of
Nutrition &amp; Metabolism, 65(3), 227-233. van Buuren, S. (2012).
<em>Flexible imputation of missing data</em>. Boca Raton, FL: Chapman &amp;
Hall/CRC.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Stef van Buuren 2021</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">datasets</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/r/datasets/ChickWeight.html" class="external-link">ChickWeight</a></span></span></span>
<span class="r-in"><span><span class="va">data</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   weight Time Chick Diet</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     42    0     1    1</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># find matches for observation in row 1</span></span></span>
<span class="r-in"><span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu">calculate_matches2</span><span class="op">(</span><span class="va">data</span>, <span class="va">data</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>,</span></span>
<span class="r-in"><span>  subset <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"1"</span>,</span></span>
<span class="r-in"><span>  y_name <span class="op">=</span> <span class="st">"weight"</span>, x_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Time"</span>, <span class="st">"Diet"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># data of matched cases (may vary because of tie breaking)</span></span></span>
<span class="r-in"><span><span class="va">data</span><span class="op">[</span><span class="fu"><a href="extract_matches.html">extract_matches</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span>, <span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     weight Time Chick Diet</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13      40    0     2    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25      43    0     3    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 61      41    0     6    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 73      41    0     7    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 85      42    0     8    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 108     41    0    10    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 132     41    0    12    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 156     41    0    14    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 176     41    0    16    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 209     41    0    20    1</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># without tie breaking, we pick the earlier rows (not recommended)</span></span></span>
<span class="r-in"><span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu">calculate_matches2</span><span class="op">(</span><span class="va">data</span>, <span class="va">data</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span>,</span></span>
<span class="r-in"><span>  subset <span class="op">=</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="st">"1"</span>,</span></span>
<span class="r-in"><span>  y_name <span class="op">=</span> <span class="st">"weight"</span>, x_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Time"</span>, <span class="st">"Diet"</span><span class="op">)</span>, break_ties <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">data</span><span class="op">[</span><span class="fu"><a href="extract_matches.html">extract_matches</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span>, <span class="op">]</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     weight Time Chick Diet</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13      40    0     2    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25      43    0     3    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 37      42    0     4    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 49      41    0     5    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 61      41    0     6    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 73      41    0     7    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 85      42    0     8    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 96      42    0     9    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 108     41    0    10    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 120     43    0    11    1</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Stef van Buuren, Arjan Huizing.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

